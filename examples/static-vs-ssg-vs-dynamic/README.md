# Static vs SSG vs Server

This demo shows the various ways next.js can render pages. There are three ways:

λ (Server) server-side renders at runtime (uses getInitialProps or getServerSideProps)  
○ (Static) automatically rendered as static HTML (uses no initial props)  
● (SSG) automatically generated as static HTML + JSON (uses getStaticProps)

We'll take a look at each below.

## Installation

```bash
npm init next-app --example static-vs-ssg-vs-dynamic static-vs-ssg-vs-dynamic-app
# or
yarn create next-app --example static-vs-ssg-vs-dynamic static-vs-ssg-vs-dynamic-app
```

```
yarn build
yarn start
```

When you run `yarn build`, you should get something like this:

```
Page                                                           Size     First Load
┌ ○ /404                                                       3.15 kB     61.1 kB
├ λ /server                                                    311 B       58.2 kB
├ ● /ssg                                                       310 B       58.2 kB
└ ○ /static                                                    304 B       58.2 kB
+ shared by all                                                57.9 kB
  ├ static/pages/_app.js                                       957 B
  ├ chunks/e6c6e46d9fd2650763d95ba5626e0b6df4ad70f7.92878c.js  10.3 kB
  ├ chunks/framework.0f140d.js                                 40 kB
  ├ runtime/main.5df208.js                                     5.95 kB
  └ runtime/webpack.b65cab.js                                  746 B

λ  (Server)  server-side renders at runtime (uses getInitialProps or getServerSideProps)
○  (Static)  automatically rendered as static HTML (uses no initial props)
●  (SSG)     automatically generated as static HTML + JSON (uses getStaticProps)
```

## Discussion

### Pure static pages

Look in `./pages/static.tsx` to follow along.

Static page generation is the simplest form. Everything is initialized client-side. This is
most like your standard React app.

At `yarn build`, there is no `getStaticProps` or `getServerSideProps`, so next
knows it can statically render the entire page to an HTML file.

The `static.html` generated by next looks something like this:

```html
<div id="__next">
  <div>1585505254535</div>
</div>
<script id="__NEXT_DATA__" type="application/json">
  {
    "props": { "pageProps": {} },
    "page": "/static",
    "query": {},
    "buildId": "WR7yhdoABPtlP2VcVweN5",
    "nextExport": true,
    "autoExport": true,
    "isFallback": false
  }
</script>
```

Key steps:

1. The static HTML is rendered. Your page is not interactive.
2. React boots. Now your page is interactive.

### Server-side generated pages

Look in `./pages/ssg.tsx` to follow along.

A server-side generated page (SSG) is slightly more advanced. It's still a static page in the end,
but there is a chance to query data server-side at `yarn build` time. To do this, we take
advantage of an initial set of props being passed in from `getStaticProps`.

At `yarn build`, `getStaticProps` is called. The return value is stored in
the static HTML file using `__NEXT_DATA__`. The component is also rendered
server-side, so the actual HTML rendering is also injected in the static HTML
file.

The `ssg.html` generated by next looks something like this:

```html
<div id="__next">
  <div>1585505254535</div>
</div>
<script id="__NEXT_DATA__" type="application/json">
  {
    "props": { "pageProps": { "ms": 1585505254535 }, "__N_SSG": true },
    "page": "/static",
    "query": {},
    "buildId": "CHi3bLv0OzOE1Epvl4Yyz",
    "nextExport": false,
    "isFallback": false,
    "gsp": true
  }
</script>
```

Key steps:

1. The static HTML is rendered. Your page is not interactive.
2. React boots and hydrates with `pageProps`. Notice the `ms` property. This came
   from `getStaticProps` and is the same as what is already rendered.
3. Now your page is interactive.

### Server (dynamic) pages

Look in `./pages/server.tsx` to follow along.

A server (dynamic) page does SSR at each web request. Nothing happens at `yarn build`,
and everything happens at `yarn start` when a request comes in. To do this, we take
advantage of `getServerSideProps`.

`getServerSideProps` runs at each web request. The resulting HTML is identical
to the other samples, but it is generated dynamically and populated server-side.

The `server.html` generated by next looks something like this:

```html
<div id="__next">
  <div>1585505254535</div>
</div>
<script id="__NEXT_DATA__" type="application/json">
  {
    "props": { "pageProps": { "ms": 1585505254535 }, "__N_SSG": true },
    "page": "/static",
    "query": {},
    "buildId": "CHi3bLv0OzOE1Epvl4Yyz",
    "nextExport": false,
    "isFallback": false,
    "gsp": true
  }
</script>
```

Key steps:

1. A web request comes in
2. The next server generates SSR HTML on the spot.
3. The HTML is delivered to the client and displays the static result. The page is not interacive yet.
4. React boots and hydrates with `pageProps`. Notice the `ms` property. This came
   from `getServerSideProps` and was just generated milliseconds ago.
5. Now your page is interactive.
