import type { GetStaticProps, InferGetStaticPropsType, NextPage } from 'next'
import Head from 'next/head'
import fs from 'fs'
import { join } from 'path'
import matter from 'gray-matter'
import { ListGroup } from 'react-bootstrap'
import Link from 'next/link'

const Home: NextPage<InferGetStaticPropsType<typeof getStaticProps>> = ({
  docs,
}) => {
  return (
    <div>
      <Head>
        <title>Markdoc example</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <ListGroup variant="flush">
        {docs.map((doc) => {
          return (
            <Link href={doc.path} key={doc.path} passHref>
              <ListGroup.Item>{doc.title}</ListGroup.Item>
            </Link>
          )
        })}
      </ListGroup>
    </div>
  )
}

export const getStaticProps: GetStaticProps<{
  docs: Array<{
    title: string
    path: string
  }>
}> = async () => {
  const docsDirectory = join(process.cwd(), 'pages/docs')
  const files = fs.readdirSync(docsDirectory)
  const docs = files.map((fileName) => {
    const content = fs.readFileSync(join(docsDirectory, fileName), 'utf-8')
    const { data } = matter(content)
    return {
      title: data.title,
      path: join('docs', fileName.replace(/.md$/, '')),
    }
  })
  return {
    props: {
      docs,
    },
  }
}

export default Home
