(()=>{"use strict";var e={308:e=>{var t=Object.prototype.hasOwnProperty,r="~";function Events(){}if(Object.create){Events.prototype=Object.create(null);if(!(new Events).__proto__)r=false}function EE(e,t,r){this.fn=e;this.context=t;this.once=r||false}function addListener(e,t,n,i,s){if(typeof n!=="function"){throw new TypeError("The listener must be a function")}var o=new EE(n,i||e,s),u=r?r+t:t;if(!e._events[u])e._events[u]=o,e._eventsCount++;else if(!e._events[u].fn)e._events[u].push(o);else e._events[u]=[e._events[u],o];return e}function clearEvent(e,t){if(--e._eventsCount===0)e._events=new Events;else delete e._events[t]}function EventEmitter(){this._events=new Events;this._eventsCount=0}EventEmitter.prototype.eventNames=function eventNames(){var e=[],n,i;if(this._eventsCount===0)return e;for(i in n=this._events){if(t.call(n,i))e.push(r?i.slice(1):i)}if(Object.getOwnPropertySymbols){return e.concat(Object.getOwnPropertySymbols(n))}return e};EventEmitter.prototype.listeners=function listeners(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,s=n.length,o=new Array(s);i<s;i++){o[i]=n[i].fn}return o};EventEmitter.prototype.listenerCount=function listenerCount(e){var t=r?r+e:e,n=this._events[t];if(!n)return 0;if(n.fn)return 1;return n.length};EventEmitter.prototype.emit=function emit(e,t,n,i,s,o){var u=r?r+e:e;if(!this._events[u])return false;var a=this._events[u],l=arguments.length,c,h;if(a.fn){if(a.once)this.removeListener(e,a.fn,undefined,true);switch(l){case 1:return a.fn.call(a.context),true;case 2:return a.fn.call(a.context,t),true;case 3:return a.fn.call(a.context,t,n),true;case 4:return a.fn.call(a.context,t,n,i),true;case 5:return a.fn.call(a.context,t,n,i,s),true;case 6:return a.fn.call(a.context,t,n,i,s,o),true}for(h=1,c=new Array(l-1);h<l;h++){c[h-1]=arguments[h]}a.fn.apply(a.context,c)}else{var f=a.length,v;for(h=0;h<f;h++){if(a[h].once)this.removeListener(e,a[h].fn,undefined,true);switch(l){case 1:a[h].fn.call(a[h].context);break;case 2:a[h].fn.call(a[h].context,t);break;case 3:a[h].fn.call(a[h].context,t,n);break;case 4:a[h].fn.call(a[h].context,t,n,i);break;default:if(!c)for(v=1,c=new Array(l-1);v<l;v++){c[v-1]=arguments[v]}a[h].fn.apply(a[h].context,c)}}}return true};EventEmitter.prototype.on=function on(e,t,r){return addListener(this,e,t,r,false)};EventEmitter.prototype.once=function once(e,t,r){return addListener(this,e,t,r,true)};EventEmitter.prototype.removeListener=function removeListener(e,t,n,i){var s=r?r+e:e;if(!this._events[s])return this;if(!t){clearEvent(this,s);return this}var o=this._events[s];if(o.fn){if(o.fn===t&&(!i||o.once)&&(!n||o.context===n)){clearEvent(this,s)}}else{for(var u=0,a=[],l=o.length;u<l;u++){if(o[u].fn!==t||i&&!o[u].once||n&&o[u].context!==n){a.push(o[u])}}if(a.length)this._events[s]=a.length===1?a[0]:a;else clearEvent(this,s)}return this};EventEmitter.prototype.removeAllListeners=function removeAllListeners(e){var t;if(e){t=r?r+e:e;if(this._events[t])clearEvent(this,t)}else{this._events=new Events;this._eventsCount=0}return this};EventEmitter.prototype.off=EventEmitter.prototype.removeListener;EventEmitter.prototype.addListener=EventEmitter.prototype.on;EventEmitter.prefixed=r;EventEmitter.EventEmitter=EventEmitter;if(true){e.exports=EventEmitter}}};var t={};function __nccwpck_require__(r){var n=t[r];if(n!==undefined){return n.exports}var i=t[r]={exports:{}};var s=true;try{e[r](i,i.exports,__nccwpck_require__);s=false}finally{if(s)delete t[r]}return i.exports}(()=>{__nccwpck_require__.d=(e,t)=>{for(var r in t){if(__nccwpck_require__.o(t,r)&&!__nccwpck_require__.o(e,r)){Object.defineProperty(e,r,{enumerable:true,get:t[r]})}}}})();(()=>{__nccwpck_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})();(()=>{__nccwpck_require__.r=e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})}})();if(typeof __nccwpck_require__!=="undefined")__nccwpck_require__.ab=__dirname+"/";var r={};(()=>{__nccwpck_require__.r(r);__nccwpck_require__.d(r,{default:()=>PQueue});var e=__nccwpck_require__(308);const t=null&&EventEmitter;class TimeoutError extends Error{constructor(e){super(e);this.name="TimeoutError"}}class AbortError extends Error{constructor(e){super();this.name="AbortError";this.message=e}}const getDOMException=e=>globalThis.DOMException===undefined?new AbortError(e):new DOMException(e);const getAbortedReason=e=>{const t=e.reason===undefined?getDOMException("This operation was aborted."):e.reason;return t instanceof Error?t:getDOMException(t)};function pTimeout(e,t){const{milliseconds:r,fallback:n,message:i,customTimers:s={setTimeout:setTimeout,clearTimeout:clearTimeout}}=t;let o;const u=new Promise(((u,a)=>{if(typeof r!=="number"||Math.sign(r)!==1){throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${r}\``)}if(t.signal){const{signal:e}=t;if(e.aborted){a(getAbortedReason(e))}e.addEventListener("abort",(()=>{a(getAbortedReason(e))}))}if(r===Number.POSITIVE_INFINITY){e.then(u,a);return}const l=new TimeoutError;o=s.setTimeout.call(undefined,(()=>{if(n){try{u(n())}catch(e){a(e)}return}if(typeof e.cancel==="function"){e.cancel()}if(i===false){u()}else if(i instanceof Error){a(i)}else{l.message=i??`Promise timed out after ${r} milliseconds`;a(l)}}),r);(async()=>{try{u(await e)}catch(e){a(e)}})()}));const a=u.finally((()=>{a.clear()}));a.clear=()=>{s.clearTimeout.call(undefined,o);o=undefined};return a}function lowerBound(e,t,r){let n=0;let i=e.length;while(i>0){const s=Math.trunc(i/2);let o=n+s;if(r(e[o],t)<=0){n=++o;i-=s+1}else{i=s}}return n}class PriorityQueue{#e=[];enqueue(e,t){t={priority:0,...t};const r={priority:t.priority,run:e};if(this.size&&this.#e[this.size-1].priority>=t.priority){this.#e.push(r);return}const n=lowerBound(this.#e,r,((e,t)=>t.priority-e.priority));this.#e.splice(n,0,r)}dequeue(){const e=this.#e.shift();return e?.run}filter(e){return this.#e.filter((t=>t.priority===e.priority)).map((e=>e.run))}get size(){return this.#e.length}}class PQueue extends e{#t;#r;#n=0;#i;#s;#o=0;#u;#a;#e;#l;#c=0;#h;#f;#v;timeout;constructor(e){super();e={carryoverConcurrencyCount:false,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:true,queueClass:PriorityQueue,...e};if(!(typeof e.intervalCap==="number"&&e.intervalCap>=1)){throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${e.intervalCap?.toString()??""}\` (${typeof e.intervalCap})`)}if(e.interval===undefined||!(Number.isFinite(e.interval)&&e.interval>=0)){throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${e.interval?.toString()??""}\` (${typeof e.interval})`)}this.#t=e.carryoverConcurrencyCount;this.#r=e.intervalCap===Number.POSITIVE_INFINITY||e.interval===0;this.#i=e.intervalCap;this.#s=e.interval;this.#e=new e.queueClass;this.#l=e.queueClass;this.concurrency=e.concurrency;this.timeout=e.timeout;this.#v=e.throwOnTimeout===true;this.#f=e.autoStart===false}get#d(){return this.#r||this.#n<this.#i}get#p(){return this.#c<this.#h}#m(){this.#c--;this.#y();this.emit("next")}#_(){this.#E();this.#w();this.#a=undefined}get#I(){const e=Date.now();if(this.#u===undefined){const t=this.#o-e;if(t<0){this.#n=this.#t?this.#c:0}else{if(this.#a===undefined){this.#a=setTimeout((()=>{this.#_()}),t)}return true}}return false}#y(){if(this.#e.size===0){if(this.#u){clearInterval(this.#u)}this.#u=undefined;this.emit("empty");if(this.#c===0){this.emit("idle")}return false}if(!this.#f){const e=!this.#I;if(this.#d&&this.#p){const t=this.#e.dequeue();if(!t){return false}this.emit("active");t();if(e){this.#w()}return true}}return false}#w(){if(this.#r||this.#u!==undefined){return}this.#u=setInterval((()=>{this.#E()}),this.#s);this.#o=Date.now()+this.#s}#E(){if(this.#n===0&&this.#c===0&&this.#u){clearInterval(this.#u);this.#u=undefined}this.#n=this.#t?this.#c:0;this.#b()}#b(){while(this.#y()){}}get concurrency(){return this.#h}set concurrency(e){if(!(typeof e==="number"&&e>=1)){throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`)}this.#h=e;this.#b()}async#g(e){return new Promise(((t,r)=>{e.addEventListener("abort",(()=>{r(e.reason)}),{once:true})}))}async add(e,t={}){t={timeout:this.timeout,throwOnTimeout:this.#v,...t};return new Promise(((r,n)=>{this.#e.enqueue((async()=>{this.#c++;this.#n++;try{t.signal?.throwIfAborted();let n=e({signal:t.signal});if(t.timeout){n=pTimeout(Promise.resolve(n),{milliseconds:t.timeout})}if(t.signal){n=Promise.race([n,this.#g(t.signal)])}const i=await n;r(i);this.emit("completed",i)}catch(e){if(e instanceof TimeoutError&&!t.throwOnTimeout){r();return}n(e);this.emit("error",e)}finally{this.#m()}}),t);this.emit("add");this.#y()}))}async addAll(e,t){return Promise.all(e.map((async e=>this.add(e,t))))}start(){if(!this.#f){return this}this.#f=false;this.#b();return this}pause(){this.#f=true}clear(){this.#e=new this.#l}async onEmpty(){if(this.#e.size===0){return}await this.#C("empty")}async onSizeLessThan(e){if(this.#e.size<e){return}await this.#C("next",(()=>this.#e.size<e))}async onIdle(){if(this.#c===0&&this.#e.size===0){return}await this.#C("idle")}async#C(e,t){return new Promise((r=>{const listener=()=>{if(t&&!t()){return}this.off(e,listener);r()};this.on(e,listener)}))}get size(){return this.#e.size}sizeBy(e){return this.#e.filter(e).length}get pending(){return this.#c}get isPaused(){return this.#f}}})();module.exports=r})();